<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Geometric image properties assessment</title>

<script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Array Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li>
  <a href="Basic.html">Basic Image Properties</a>
</li>
<li>
  <a href="Geom.html">Geometric Image Properties</a>
</li>
<li>
  <a href="Auto.html">Automation Explorations</a>
</li>
<li>
  <a href="WarpWhole.html">Warp Explorations</a>
</li>
<li>
  <a href="Filter.html">Simple Filters</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Geometric image properties assessment</h1>

</div>


<p>In this section we explore the geometric properties of the array itself. In this analysis we specify some data manually and use it to explore array geometric corrections. Once we have an understanding of the distortions we can look at automated correction strategies.</p>
<p>This report section was generated using RMarkdown in RStudio with the <a href="https://rstudio.github.io/reticulate/index.html">r-reticulate</a> package to support Python sections. The included script generates the figures.</p>
<p>I used this project to also learn Python (so don’t judge the code elements :) ).</p>
<p>I have included the code for your interest but hidden it by default to improve readability.</p>
<p>Look in the <a href="about.html">About</a> section for libraries and default parameters.</p>
<div id="analysis" class="section level1">
<h1>Analysis</h1>
<p>In this analysis we don’t try to correct the base images themselves. A uniform grid of pad locations is projected in to image space to allow us to review how basic transforms perform in capturing the grids.</p>
<div id="guess-where-the-sub-arrays-may-be" class="section level3">
<h3>Guess where the sub arrays may be</h3>
<p>The basic review showed that in the 488 image at least the background between the arrays is lower so here we explore a quick and easy way to obtain a ‘ball park’ estimate which we then could use template matching or a similar approach to derive accurate array edge points instead of the manually supplied ones.</p>
<p>All we are doing is creating a sum of the pixels columns (blue) and then rows (orange). The horizontal green lines mark percentiles of the column sums (we use it to choose a threshold). The vertical red and purple lines are the boundaries that result which are then displayed in cyan on the image.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># take a guess where the inter subarray regions are based on grey level values</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>threshPerc<span class="op">=</span><span class="dv">8</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>colSums<span class="op">=</span> origimg.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>rowSums<span class="op">=</span> origimg.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>percen<span class="op">=</span>np.percentile(colSums,(<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>arrX<span class="op">=</span>gridBorders(colSums,threshPerc)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>arrY<span class="op">=</span>gridBorders(rowSums,threshPerc)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>plt.ioff()<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">0</span>,<span class="bu">len</span>(colSums)),colSums)<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">0</span>,<span class="bu">len</span>(rowSums)),rowSums)<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>plt.vlines(arrX,<span class="dv">0</span>,percen[<span class="dv">8</span>],colors<span class="op">=</span>np.repeat(<span class="st">&#39;r&#39;</span>,<span class="bu">len</span>(arrX)))<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>plt.vlines(arrY,<span class="dv">0</span>,percen[<span class="dv">8</span>],colors<span class="op">=</span>np.repeat(<span class="st">&#39;purple&#39;</span>,<span class="bu">len</span>(arrY)))<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>plt.hlines(percen,<span class="dv">0</span>,<span class="bu">len</span>(colSums),<span class="st">&#39;g&#39;</span>)<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="Geom_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># draw them on the image</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">0</span>,<span class="bu">len</span>(arrX),<span class="dv">2</span>):</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  colimg<span class="op">=</span>cv.rectangle(colimg,(arrX[i],<span class="dv">0</span>),(arrX[i<span class="op">+</span><span class="dv">1</span>],colimg.shape[<span class="dv">1</span>]),(<span class="dv">65535</span>,<span class="dv">65535</span>,<span class="dv">0</span>),<span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">0</span>,<span class="bu">len</span>(arrY),<span class="dv">2</span>):</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  colimg<span class="op">=</span>cv.rectangle(colimg,(<span class="dv">0</span>,arrY[i]),(colimg.shape[<span class="dv">0</span>],arrY[i<span class="op">+</span><span class="dv">1</span>]),(<span class="dv">65535</span>,<span class="dv">65535</span>,<span class="dv">0</span>),<span class="dv">1</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the manually defined patches on too</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patchName <span class="kw">in</span> patches:</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    pts<span class="op">=</span>patches[patchName]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    colimg<span class="op">=</span>cv.polylines(colimg,[pts.reshape((<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>))],<span class="va">True</span>,(<span class="dv">65535</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    colimg<span class="op">=</span>cv.putText(colimg,patchName,(pts[<span class="dv">0</span>,<span class="dv">0</span>],pts[<span class="dv">0</span>,<span class="dv">1</span>]<span class="op">-</span><span class="dv">2</span><span class="op">*</span>interpad),cv.FONT_HERSHEY_SIMPLEX,<span class="dv">1</span>,(<span class="dv">65535</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dv">2</span>,cv.LINE_AA)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>guessImageFile<span class="op">=</span>folderStub<span class="op">+</span>fileStub<span class="op">+</span><span class="st">&quot; origGuess.png&quot;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ok<span class="op">=</span>cv.imwrite(guessImageFile, colimg)</span></code></pre></div>
<p>It seems to work reasonably well with 488 and likely with images with at least bit depth of this level but it is not as clean with 647 but it does reduce the search space a great deal. Cyan are the guesses at the borders between sub arrays and magenta shows the manually defined sub array boundaries.</p>
<p><img src="procimage/im488%20origGuess.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488%20origGuess.png">procimage/im488 origGuess.png</a></p>
<p>and for 647 <img src="procimage/im647%20origGuess.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im647%20origGuess.png">procimage/im647 origGuess.png</a></p>
<p><br><br></p>
</div>
<div id="geometric-assessment-of-sub-array-patches" class="section level2">
<h2>Geometric assessment of sub array patches</h2>
<p>We will now cut out and zoom in on the patches, overlay a grid on the feature elements and asses them.</p>
<p>First we will process and create images and then explore them individually.</p>
<p>The affine transform uses three points (the top left, top right and bottom right) so the most likely misalignment will be in the bottom left corner. Misalignment in the corner may be due to inaccuracy of the manually selected points or the transformation not being sufficient to overcome the image distortion.</p>
<p>In general, affine performs reasonably well under visual inspection with the exception of Patch 4. The perspective transformation seems to perform well in all cases and is probably the best ‘first step’. We may explore optimising the ‘pad circles’ by minor individual shifting in a follow on analysis.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patchName <span class="kw">in</span> patches:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    pts<span class="op">=</span>patches[patchName]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create a uniform reference grid based on our manual parameters</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    estimatedRectSide<span class="op">=</span>(numPads<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>interpad</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    ptsRef<span class="op">=</span>np.array([[<span class="dv">0</span>,<span class="dv">0</span>],[estimatedRectSide,<span class="dv">0</span>],[estimatedRectSide,estimatedRectSide],[<span class="dv">0</span>,estimatedRectSide]],np.int32)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># work out the sub area of the image to crop out</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    cropPad<span class="op">=</span>interpad<span class="op">*</span><span class="dv">3</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    xcrop<span class="op">=</span><span class="bu">min</span>(pts[<span class="dv">0</span>:<span class="dv">4</span>,<span class="dv">0</span>])<span class="op">-</span>cropPad</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    xcropEnd<span class="op">=</span><span class="bu">max</span>(pts[<span class="dv">0</span>:<span class="dv">4</span>,<span class="dv">0</span>])<span class="op">+</span>cropPad</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    ycrop<span class="op">=</span><span class="bu">min</span>(pts[<span class="dv">0</span>:<span class="dv">4</span>,<span class="dv">1</span>])<span class="op">-</span>cropPad<span class="op">*</span><span class="dv">4</span> <span class="co"># leave space for the text</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    ycropEnd<span class="op">=</span><span class="bu">max</span>(pts[<span class="dv">0</span>:<span class="dv">4</span>,<span class="dv">1</span>])<span class="op">+</span>cropPad</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    xoffset<span class="op">=</span>pts[<span class="dv">0</span>,<span class="dv">0</span>]<span class="op">-</span>xcrop</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    yoffset<span class="op">=</span>pts[<span class="dv">0</span>,<span class="dv">1</span>]<span class="op">-</span>ycrop</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    cropOrig<span class="op">=</span>origimg[ycrop:ycropEnd,xcrop:xcropEnd]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    ok<span class="op">=</span>cv.imwrite(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; origCrop.tif&quot;</span>, cropOrig)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate affine and perspective transforms between reference and image space </span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># based on the manual points</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    Mback <span class="op">=</span> cv.getAffineTransform(np.float32(ptsRef[<span class="dv">0</span>:<span class="dv">3</span>]),np.float32(pts[<span class="dv">0</span>:<span class="dv">3</span>]))</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    MbackP <span class="op">=</span> cv.getPerspectiveTransform(np.float32(ptsRef[<span class="dv">0</span>:<span class="dv">4</span>]),np.float32(pts[<span class="dv">0</span>:<span class="dv">4</span>]))</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create an image to display the affine transformed points</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    cropImg<span class="op">=</span>colimg[ycrop:ycropEnd,xcrop:xcropEnd]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    resAffine <span class="op">=</span> cv.resize(cropImg,<span class="va">None</span>,fx<span class="op">=</span>scaleFac, fy<span class="op">=</span>scaleFac, interpolation <span class="op">=</span> cv.INTER_NEAREST)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    ok<span class="op">=</span>cv.imwrite(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; subAreaZoom.png&quot;</span>, resAffine)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    resAffine<span class="op">=</span>cv.putText(resAffine,<span class="st">&quot;Affine transformed fixed grid. Manual grid region selection.&quot;</span>,(resAffine.shape[<span class="dv">0</span>]<span class="op">//</span><span class="dv">8</span>,<span class="dv">90</span>),cv.FONT_HERSHEY_SIMPLEX,<span class="dv">2</span>,(<span class="dv">65535</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dv">2</span>,cv.LINE_AA)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create an image to display the perspective transformed points</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    cropImg<span class="op">=</span>colimg[ycrop:ycropEnd,xcrop:xcropEnd]</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    resPersp <span class="op">=</span> cv.resize(cropImg,<span class="va">None</span>,fx<span class="op">=</span>scaleFac, fy<span class="op">=</span>scaleFac, interpolation <span class="op">=</span> cv.INTER_NEAREST)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    resPersp<span class="op">=</span>cv.putText(resPersp,<span class="st">&quot;Perspective transformed fixed grid. Manual grid region selection.&quot;</span>,(resPersp.shape[<span class="dv">0</span>]<span class="op">//</span><span class="dv">8</span>,<span class="dv">90</span>),cv.FONT_HERSHEY_SIMPLEX,<span class="dv">2</span>,(<span class="dv">65535</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dv">2</span>,cv.LINE_AA)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    rad<span class="op">=</span>np.int32(interpad<span class="op">*</span>scaleFac<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    pixvals<span class="op">=</span>np.empty([numPads,numPads])</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,numPads):</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,numPads):</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>            xval<span class="op">=</span>np.floor(x<span class="op">*</span>interpad<span class="op">+</span>interpad)  </span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>            yval<span class="op">=</span>np.floor(y<span class="op">*</span>interpad<span class="op">+</span>interpad)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>            xtran<span class="op">=</span>rowMult(Mback,<span class="dv">0</span>,xval,yval)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>            ytran<span class="op">=</span>rowMult(Mback,<span class="dv">1</span>,xval,yval)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>            resAffine<span class="op">=</span>cv.circle(resAffine,(np.int32(scaleFac<span class="op">*</span>(xtran<span class="op">-</span>xcrop)),np.int32(scaleFac<span class="op">*</span>(ytran<span class="op">-</span>ycrop))),rad,(<span class="dv">0</span>,<span class="dv">65535</span>,<span class="dv">0</span>),<span class="dv">1</span>)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>            perScale<span class="op">=</span>rowMult(MbackP,<span class="dv">2</span>,xval,yval)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>            xtran<span class="op">=</span>rowMult(MbackP,<span class="dv">0</span>,xval,yval)<span class="op">/</span>perScale</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>            ytran<span class="op">=</span>rowMult(MbackP,<span class="dv">1</span>,xval,yval)<span class="op">/</span>perScale</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>            resPersp<span class="op">=</span>cv.circle(resPersp,(np.int32(scaleFac<span class="op">*</span>(xtran<span class="op">-</span>xcrop)),np.int32(scaleFac<span class="op">*</span>(ytran<span class="op">-</span>ycrop))),rad,(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">65535</span>),<span class="dv">1</span>)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># sum the image pixels in a &#39;pad&#39; centred around the transformed perspective transform</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>            <span class="co"># doing the rows and columns this way to match what matshow expects to get things the right way up</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>            pixvals[y,x]<span class="op">=</span>np.<span class="bu">sum</span>(origimg[np.int32(ytran<span class="op">-</span>interpad):np.int32(ytran<span class="op">+</span>interpad),np.int32(xtran<span class="op">-</span>interpad):np.int32(xtran<span class="op">+</span>interpad)])</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    ok<span class="op">=</span>cv.imwrite(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; subAreaZoomAffineGrid.png&quot;</span>, resAffine)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    ok<span class="op">=</span>cv.imwrite(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; subAreaZoomPerspGrid.png&quot;</span>, resPersp)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    ok<span class="op">=</span>cv.imwrite(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; TLsubAreaZoomAffineGrid.png&quot;</span>, resAffine[<span class="dv">0</span>:<span class="dv">500</span>,<span class="dv">0</span>:<span class="dv">600</span>])</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    ok<span class="op">=</span>cv.imwrite(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; TLsubAreaZoomPerspGrid.png&quot;</span>, resPersp[<span class="dv">0</span>:<span class="dv">500</span>,<span class="dv">0</span>:<span class="dv">600</span>])</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    ok<span class="op">=</span>cv.imwrite(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; BLsubAreaZoomAffineGrid.png&quot;</span>, resAffine[<span class="dv">2300</span>:<span class="dv">2800</span>,<span class="dv">0</span>:<span class="dv">600</span>])</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    ok<span class="op">=</span>cv.imwrite(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; BLsubAreaZoomPerspGrid.png&quot;</span>, resPersp[<span class="dv">2300</span>:<span class="dv">2800</span>,<span class="dv">0</span>:<span class="dv">600</span>])</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    plt.ioff()</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    plt.hist(pixvals.flatten(),bins<span class="op">=</span><span class="dv">256</span>, color <span class="op">=</span> <span class="st">&#39;r&#39;</span>)<span class="op">;</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&#39;Histogram of pad pixel sums for &#39;</span><span class="op">+</span>fileStub<span class="op">+</span><span class="st">&#39; &#39;</span><span class="op">+</span>patchName)<span class="op">;</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)<span class="op">;</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    plt.savefig(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; subAreaZoomPerspGridHist.png&quot;</span>)<span class="op">;</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    plt.close()<span class="op">;</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    plt.ioff()</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    plt.matshow(pixvals,interpolation<span class="op">=</span><span class="st">&quot;none&quot;</span>)<span class="op">;</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&#39;Map of pad pixel sums for &#39;</span><span class="op">+</span>fileStub<span class="op">+</span><span class="st">&#39; &#39;</span><span class="op">+</span>patchName)<span class="op">;</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    plt.savefig(folderStub<span class="op">+</span>fileStub<span class="op">+</span>patchName<span class="op">+</span> <span class="st">&quot; subAreaZoomPerspGridMatView.png&quot;</span>)<span class="op">;</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    plt.close()<span class="op">;</span></span></code></pre></div>
<p>Time for this code chunk to run: 5.106 s</p>
<div id="patch-1" class="section level3">
<h3>Patch 1</h3>
<p><img src="procimage/im488Patch%201%20subAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%201%20subAreaZoomAffineGrid.png">procimage/im488Patch 1 subAreaZoomAffineGrid.png</a></p>
<div id="zoom-of-top-left-of-patch" class="section level4">
<h4>Zoom of top left of patch</h4>
<p><img src="procimage/im488Patch%201%20TLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%201%20TLsubAreaZoomAffineGrid.png">procimage/im488Patch 1 TLsubAreaZoomAffineGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p>There are quite a few examples of the centre of the dark spots not being aligned in the outlines for the pad.</p>
<p><img src="procimage/im488Patch%201%20BLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%201%20BLsubAreaZoomAffineGrid.png">procimage/im488Patch 1 BLsubAreaZoomAffineGrid.png</a></p>
<p><img src="procimage/im488Patch%201%20subAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%201%20subAreaZoomPerspGrid.png">procimage/im488Patch 1 subAreaZoomPerspGrid.png</a></p>
<p><img src="procimage/im488Patch%201%20TLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%201%20TLsubAreaZoomPerspGrid.png">procimage/im488Patch 1 TLsubAreaZoomPerspGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-1" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p>In general almost all of the features look to be within the outlines with only minor adjustments necessary.</p>
<p><img src="procimage/im488Patch%201%20BLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%201%20BLsubAreaZoomPerspGrid.png">procimage/im488Patch 1 BLsubAreaZoomPerspGrid.png</a></p>
</div>
</div>
<div id="patch-2" class="section level3">
<h3>Patch 2</h3>
<p><img src="procimage/im488Patch%202%20subAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%202%20subAreaZoomAffineGrid.png">procimage/im488Patch 2 subAreaZoomAffineGrid.png</a></p>
<div id="zoom-of-top-left-of-patch-1" class="section level4">
<h4>Zoom of top left of patch</h4>
<p><img src="procimage/im488Patch%202%20TLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%202%20TLsubAreaZoomAffineGrid.png">procimage/im488Patch 2 TLsubAreaZoomAffineGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-2" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p><img src="procimage/im488Patch%202%20BLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%202%20BLsubAreaZoomAffineGrid.png">procimage/im488Patch 2 BLsubAreaZoomAffineGrid.png</a></p>
<p><img src="procimage/im488Patch%202%20subAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%202%20subAreaZoomPerspGrid.png">procimage/im488Patch 2 subAreaZoomPerspGrid.png</a></p>
<p><img src="procimage/im488Patch%202%20TLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%202%20TLsubAreaZoomPerspGrid.png">procimage/im488Patch 2 TLsubAreaZoomPerspGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-3" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p><img src="procimage/im488Patch%202%20BLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%202%20BLsubAreaZoomPerspGrid.png">procimage/im488Patch 2 BLsubAreaZoomPerspGrid.png</a></p>
<p><br><br></p>
</div>
</div>
<div id="patch-3" class="section level3">
<h3>Patch 3</h3>
<p><img src="procimage/im488Patch%203%20subAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%203%20subAreaZoomAffineGrid.png">procimage/im488Patch 3 subAreaZoomAffineGrid.png</a></p>
<div id="zoom-of-top-left-of-patch-2" class="section level4">
<h4>Zoom of top left of patch</h4>
<p><img src="procimage/im488Patch%203%20TLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%203%20TLsubAreaZoomAffineGrid.png">procimage/im488Patch 3 TLsubAreaZoomAffineGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-4" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p>Alignment generally good. Looks like there is an extra feature just off the centre of the image. This will be a good test image for the outline optimisation as it could draw the outline from the true feature.</p>
<p><img src="procimage/im488Patch%203%20BLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%203%20BLsubAreaZoomAffineGrid.png">procimage/im488Patch 3 BLsubAreaZoomAffineGrid.png</a></p>
<p><img src="procimage/im488Patch%203%20subAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%203%20subAreaZoomPerspGrid.png">procimage/im488Patch 3 subAreaZoomPerspGrid.png</a></p>
<p><img src="procimage/im488Patch%203%20TLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%203%20TLsubAreaZoomPerspGrid.png">procimage/im488Patch 3 TLsubAreaZoomPerspGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-5" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p><img src="procimage/im488Patch%203%20BLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%203%20BLsubAreaZoomPerspGrid.png">procimage/im488Patch 3 BLsubAreaZoomPerspGrid.png</a></p>
<p><br><br></p>
</div>
</div>
<div id="patch-4" class="section level3">
<h3>Patch 4</h3>
<p><img src="procimage/im488Patch%204%20subAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%204%20subAreaZoomAffineGrid.png">procimage/im488Patch 4 subAreaZoomAffineGrid.png</a></p>
<div id="zoom-of-top-left-of-patch-3" class="section level4">
<h4>Zoom of top left of patch</h4>
<p><img src="procimage/im488Patch%204%20TLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%204%20TLsubAreaZoomAffineGrid.png">procimage/im488Patch 4 TLsubAreaZoomAffineGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-6" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p>There is clear feature alignment for a distinct proportion of the features signalling that the affine transform is not the best starting estimate.</p>
<p><img src="procimage/im488Patch%204%20BLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%204%20BLsubAreaZoomAffineGrid.png">procimage/im488Patch 4 BLsubAreaZoomAffineGrid.png</a></p>
<p><img src="procimage/im488Patch%204%20subAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%204%20subAreaZoomPerspGrid.png">procimage/im488Patch 4 subAreaZoomPerspGrid.png</a></p>
<p><img src="procimage/im488Patch%204%20TLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%204%20TLsubAreaZoomPerspGrid.png">procimage/im488Patch 4 TLsubAreaZoomPerspGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-7" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p><img src="procimage/im488Patch%204%20BLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%204%20BLsubAreaZoomPerspGrid.png">procimage/im488Patch 4 BLsubAreaZoomPerspGrid.png</a></p>
</div>
</div>
<div id="patch-3-image-647" class="section level3">
<h3>Patch 3 : Image 647</h3>
<p>There aren’t many features to see on 647 but here is a patch example to see the grid overlaid that is based on 488. I chose patch 3 as there was evidence of a ‘between grid’ feature but there is no indication of it here.</p>
<p><img src="procimage/im647Patch%203%20subAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im647Patch%203%20subAreaZoomAffineGrid.png">procimage/im647Patch 3 subAreaZoomAffineGrid.png</a></p>
<div id="zoom-of-top-left-of-patch-4" class="section level4">
<h4>Zoom of top left of patch</h4>
<p><img src="procimage/im647Patch%203%20TLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im647Patch%203%20TLsubAreaZoomAffineGrid.png">procimage/im647Patch 3 TLsubAreaZoomAffineGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-8" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p>There are quite a few examples of the centre of the dark spots not being aligned in the outlines for the pad (in image 488, can’t really tell here).</p>
<p><img src="procimage/im647Patch%203%20BLsubAreaZoomAffineGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im647Patch%203%20BLsubAreaZoomAffineGrid.png">procimage/im647Patch 3 BLsubAreaZoomAffineGrid.png</a></p>
<p><img src="procimage/im647Patch%203%20subAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im647Patch%203%20subAreaZoomPerspGrid.png">procimage/im647Patch 3 subAreaZoomPerspGrid.png</a></p>
<p><img src="procimage/im647Patch%203%20TLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im647Patch%203%20TLsubAreaZoomPerspGrid.png">procimage/im647Patch 3 TLsubAreaZoomPerspGrid.png</a></p>
</div>
<div id="zoom-of-bottom-left-of-patch-9" class="section level4">
<h4>Zoom of bottom left of patch</h4>
<p>In general almost all of the features look to be within the outlines with only minor adjustments necessary.</p>
<p><img src="procimage/im647Patch%203%20BLsubAreaZoomPerspGrid.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im647Patch%203%20BLsubAreaZoomPerspGrid.png">procimage/im647Patch 3 BLsubAreaZoomPerspGrid.png</a></p>
<p><br><br></p>
</div>
</div>
</div>
<div id="simple-exploration-of-data-extracted-from-array-features-perspective-projection" class="section level2">
<h2>Simple exploration of data extracted from array features (perspective projection)</h2>
<p>In this analysis the raw pixel values from the 16 bit image are summed in a small area (plus and minus 5) centred on the projected feature location.</p>
<p>There are many other approaches we could take but we use this just to have a look.</p>
<p><br><br></p>
<div id="histograms-of-features" class="section level4">
<h4>Histograms of features</h4>
<p>There is not much to note in these, certainly no obvious ‘off versus on’. Different feature based measures and images with more dynamic range may show a dual peak. Further investigation required.</p>
<p><img src="procimage/im488Patch%201%20subAreaZoomPerspGridHist.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%201%20subAreaZoomPerspGridHist.png">procimage/im488Patch 1 subAreaZoomPerspGridHist.png</a></p>
<p><img src="procimage/im488Patch%202%20subAreaZoomPerspGridHist.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%202%20subAreaZoomPerspGridHist.png">procimage/im488Patch 2 subAreaZoomPerspGridHist.png</a></p>
<p><img src="procimage/im488Patch%203%20subAreaZoomPerspGridHist.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%203%20subAreaZoomPerspGridHist.png">procimage/im488Patch 3 subAreaZoomPerspGridHist.png</a></p>
<p><img src="procimage/im488Patch%204%20subAreaZoomPerspGridHist.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%204%20subAreaZoomPerspGridHist.png">procimage/im488Patch 4 subAreaZoomPerspGridHist.png</a></p>
<p><br><br></p>
</div>
<div id="grid-view-of-features" class="section level4">
<h4>Grid view of features</h4>
<p>There is not much to note in these either, it is just a convenient compact representation of the patch arrays. Different feature based measures and images with more dynamic range may show different properties. The views are auto scaled to range so single intense features can affect the whole plot. Further investigation required.</p>
<p><img src="procimage/im488Patch%201%20subAreaZoomPerspGridMatView.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%201%20subAreaZoomPerspGridMatView.png">procimage/im488Patch 1 subAreaZoomPerspGridMatView.png</a></p>
<p><img src="procimage/im488Patch%202%20subAreaZoomPerspGridMatView.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%202%20subAreaZoomPerspGridMatView.png">procimage/im488Patch 2 subAreaZoomPerspGridMatView.png</a></p>
<p><img src="procimage/im488Patch%203%20subAreaZoomPerspGridMatView.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%203%20subAreaZoomPerspGridMatView.png">procimage/im488Patch 3 subAreaZoomPerspGridMatView.png</a></p>
<p><img src="procimage/im488Patch%204%20subAreaZoomPerspGridMatView.png" width="100%" style="display: block; margin: auto;" /> View full image <a href="procimage/im488Patch%204%20subAreaZoomPerspGridMatView.png">procimage/im488Patch 4 subAreaZoomPerspGridMatView.png</a></p>
<p><br><br><br></p>
</div>
</div>
<div id="conclusions" class="section level2">
<h2>Conclusions</h2>
<p><br></p>
<p>Detailed review of the sub array layout and corrections. Manually driven process where we are assessing the corrections that may be required rather than looking to perform automated analysis.</p>
<p><br></p>
<div id="summary-of-the-geometric-analysis" class="section level3">
<h3>Summary of the geometric analysis</h3>
<p>Given image 488 a perspective projection of a uniform grid based on four manually selected points per patch appears to produce a good first spatial correction of the image and enables feature data to be extracted.</p>
<p>On images at least as good as 488 we should be able to compensate for the spatial distortions and reliably extract numerical data in a reasonably small amount of processing time.</p>
<p>The analysis suggests that if the patch corners can be reliably estimated automatically then array data can be extracted.</p>
<p>There were no interesting distributional properties in the histograms based on the sum of the pixels in a small area around the projected feature locations. This gives us little guidance for methodology of calling ‘on/off’ for the individual pads.</p>
<p>Future considerations:</p>
<ul>
<li>Automatically find the patch corners,</li>
<li>Post optimise the projected grid feature locations to compensate for local shifts (allow a small movement in the individual grid centres to optimise data capture),</li>
<li>Consider optimising the grids over multiple images and then applying an optimised consensus pattern to all of them (assuming the grids do not move between cycles),</li>
<li>Explore additional pixel combinations for the patch data (this will be more productive on scans with more information due to greater bit depth. Should be done after feature locations have been optimised).</li>
</ul>
<p><br><br></p>
<p><br><br><br></p>
</div>
<div id="script-timing" class="section level3">
<h3>Script timing</h3>
<p>Script execution timed for ball park purposes but it will include the report generation sections so will be an over estimate of how long it takes.</p>
<p>All the processing in this analysis including loading and saving images completed in 7.5985081 seconds.</p>
<p><strong>Machine spec:</strong> Processor Intel(R) Core(TM) i9-9900X CPU @ 3.50GHz, 3504 Mhz, 10 Core(s), 64 GB RAM</p>
</div>
</div>
</div>

<hr><footer><p style="text-align:right;font-size: 10px;"><strong>CONFIDENTIAL</strong>. For attention of intended parties only.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>Standard Disclaimers Apply:</strong>&nbsp;&nbsp;All views are my own, use at your own risk.  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &copy;&nbsp;Copyright&nbsp;2021&nbsp;David&nbsp;Bramwell </p></footer>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
